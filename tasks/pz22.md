## Практическое занятие №22. Разграничение прав доступа в ОС Ubuntu

### Ход работы

1. Вернуть сеть NAT на ВМ ubuntu
1. Создать пользователя по шаблону Surname, где Surname - ваша фамилия. Войти под этим пользователем в графическом режиме.
1. Добавить пользователя Surname в sudo-пользователи.
1. Создать в /home каталог dir. Владельцем назначить Surname. Группу-владельца задать как группу an. Выяснить, что значат права rwx для каталога.
2. Найти исполняемый файл для команды ping. Определить права доступа на этот файл. Что означает SUID-бит?
3. Выяснить права на каталог /tmp. Что значит sticky bit?
4. В /home/dir/ создать who.c, который должен содержать 

    ```c
    #include <stdio.h>
    #include <unistd.h>
    
    int main()
    {
    	printf("UID=%d, but effective UID=%d\n", getuid(), geteuid());
    	return 0;
    }
    ```
    Скомпилировать этот файл с помощью
    
    ```bash
    gcc -o WHO who.c
    ```
    С помощью SUID-бита сделать так, чтобы запуск WHO выводил на экран id вашего пользователя, а эффективный id - пользователя root.
5. Создать исполняемый файл, который ведёт себя как фоновый процесс (демон в терминологии Linux-систем). Для этого при старте этого процесса необходимо создавать так называемый .pid файл - файл, в который записывается PID запущенного процесса. При старте необходимо проверять, есть ли .pid файл, если есть - проверять наличие процесса с указанным pid. Если такой процесс уже существует, то писать об этом в стандартный поток ошибок и завершаться. Если .pid файла нет, либо нет указанного процесса, то стартовать как фоновый процесс, записывая в .pid файл свой PID.
6. Рассмотрим подробнее правильный порядок изменения сетевого имени компьютера. Необходимо внести изменения в три места

    ```bash
    # изменяет текущее сетевое имя
    sudo hostname Surname
    # изменяет сетевое имя, которое будет выставлено после перезагрузки
    sudo nano /etc/hostname
    # изменяет сетевое имя для адреся 127.0.0.1, то есть localhost
    sudo nano /etc/hosts
    ```
1. Разобраться с командой zip. Заархивируйте с различным уровнем сжатия короткий текст (100 символов), длинный текст (10к символов), картинку (возьмите любые фото с хостовой или гостевой ОС).
2. Разобраться с командой tar. Чем отличается архивирование от сжатия? Получите архив формата .tar.gz, заархивировав некоторый каталог.

### Дополнительные материалы ###

1. Существует 2 способа добавить пользователя Surname в sudo-пользователи:
* С использованием usermod
    ```bash
    usermod -a -G sudo Surname
    ```
* С использованием visudo
    ```bash
    visudo
    ```
    Выполнив данную команду, вы окажитесь в текстовом файле, где нужно найти следующую строчку:
    ```bash
    # User privilege specification
    root    ALL=(ALL:ALL) ALL
    ```
    Добавляем под ней нужного пользователя по аналогии с пользователем root:
    ```bash
	# User privilege specification
	root    ALL=(ALL:ALL) ALL
	Surname ALL=(ALL:ALL) ALL
    ```
	После этого достаточно сохранить файл, пользователю перезайти в систему и он сможет пользоваться командой sudo.
2. К середине третьего курса уже точно необходимо разобраться с правами доступа к файлам и каталогам, а также такими "загадочными" командами, как 
    ```bash
	chmod
    chown
	chgrp
    ```
	Перейдите в корневую директорию и выполните команду
    ```bash
	ls-l
    ```
	Результат выполнения должен быть вам известен. Но сейчас стоит обратить внимание на цепочку символов (которая у вас может отличаться, но иметь такую же структуру):
    ```bash
	-rwxr-xr-x
    ```
	Эти символы можно условно разделить на 4 группы.
* Первая группа, состоящая из единственного символа, определяет тип файла.
    * '-' = обычный файл;
    * d = каталог;
    * b = файл блочного устройства;
    * c = файл символьного устройства;
    * s = доменное гнездо (socket);
    * p = именованный канал (pipe);
    * l = символическая ссылка (link).
* Далее следуют три группы по три символа, которые и определяют права доступа к файлу соответственно для владельца файла(2), для группы пользователей(3), которая сопоставлена данному файлу, и для всех остальных пользователей системы(4).
	Рассмотрим подробнее, что значат условные значения флагов прав:
    * --- = нет прав, совсем;
    * --x = разрешено только выполнение файла, как программы но не изменение и не чтение;
    * -w- = разрешена только запись и изменение файла;
    * -wx = разрешено изменение и выполнение, но в случае с каталогом, вы не можете посмотреть его содержимое;
    * r-- = права только на чтение;
    * r-x = только чтение и выполнение, без права на запись;
    * rw- = права на чтение и запись, но без выполнения;
    * rwx = все права;
    * --s = установлен SUID или SGID бит, первый отображается в поле для владельца, второй для группы;
    * --t = установлен sticky-bit, а значит пользователи не могут удалить этот файл.
	Последние 2 пункта могли вызвать у вас недоумение, но не спешите расстраиваться, сейчас вы всё узнаете, если не знали этих вещей ранее.
	#### Специальные права доступа к файлам в LINUX ####
    * SUID - если этот бит установлен, то при выполнении программы, id пользователя, от которого она запущена заменяется на id владельца файла. Фактически, это позволяет обычным пользователям запускать программы от имени суперпользователя;
    * SGID - этот флаг работает аналогичным образом, только разница в том, что пользователь считается членом группы, с которой связан файл, а не групп, к которым он действительно принадлежит. Если SGID флаг установлен на каталог, все файлы, созданные в нем, будут связаны с группой каталога, а не пользователя. Такое поведение используется для организации общих папок;
    * Sticky-bit - этот бит тоже используется для создания общих папок. Если он установлен, то пользователи могут только создавать, читать и выполнять файлы, но не могут удалять файлы, принадлежащие другим пользователям.
	#### Команды управления правами ####
* chmod

	Синтаксис команды:
	```bash
	chmod опции права /путь/к/файлу
    ```
	Синтаксис настройки прав:
	```bash
	группа_пользователейдействиевид_прав
    ```
	Категории пользователей:
    * u - владелец файла;
    * g - группа файла;
    * o - все остальные пользователи.

	Примеры:
    * u+x - разрешить выполнение для владельца;
    * ugo+x - разрешить выполнение для всех;
    * ug+w - разрешить запись для владельца и группы;
    * o-x - запретить выполнение для остальных пользователей;
    * ugo+rwx - разрешить все для всех.
* chown

	Синтаксис команды:
	```bash
	chown [OPTIONS] USER[:GROUP] FILE
    ```
	* USER - имя пользователя или идентификатор пользователя (UID) нового владельца;
    * GROUP - имя новой группы или идентификатор группы (GID);
    * FILE - имя одного или нескольких файлов, каталогов или ссылок.

	Как изменить владельца и группу файла:
	```bash
	chown USER:GROUP FILE
    ```
	Как изменить группу файла:
	```bash
	chown :GROUP FILE
    ```
	Команда chown может выполнять ту же функцию, что и команда chgrp, которую мы рассмотрим далее.
* chgrp

	Данная команда изменяет группу каждого заданного файла на группу, которая может быть представлена как именем группы, так и ее числовым идентификатором (GID).

	Синтаксис команды:
	```bash
	chgrp [параметры] <имя группы пользователей> <имя файла или директории>
    ```
	Для того, чтобы сменить группу владельцев директории, а также всех находящихся в ней файлов и директорий, достаточно задействовать параметр -R.































